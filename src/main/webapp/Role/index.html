<!DOCTYPE html>
<html>
<head>
    <title></title>
    <meta charset="UTF-8">
    <link rel="stylesheet" type="text/css" href="../Css/bootstrap.css" />
    <link rel="stylesheet" type="text/css" href="../Css/bootstrap-responsive.css" />
    <link rel="stylesheet" type="text/css" href="../Css/style.css" />
    <script type="text/javascript" src="../Js/jquery.js"></script>
    <script type="text/javascript" src="../Js/jquery.sorted.js"></script>
    <script type="text/javascript" src="../Js/bootstrap.js"></script>
    <script type="text/javascript" src="../Js/ckform.js"></script>
    <script type="text/javascript" src="../Js/common.js"></script>

    <style type="text/css">
        body {
            padding-bottom: 40px;
        }
        .sidebar-nav {
            padding: 9px 0;
        }

        @media (max-width: 980px) {
            /* Enable use of floated navbar text */
            .navbar-text.pull-right {
                float: none;
                padding-left: 5px;
                padding-right: 5px;
            }
        }


    </style>
    
     <script type="text/javascript">
         String.prototype.GetValue= function(para) {
             let reg = new RegExp("(^|&)"+ para +"=([^&]*)(&|$)");
             let r = this.substr(this.indexOf("\?")+1).match(reg);
             if (r!=null) return unescape(r[2]); return null;
         }
         // 地址参数
         let globalPageNum = document.location.toString().GetValue("pageNum");
         let globalPageSize = document.location.toString().GetValue("pageSize");

         if(globalPageNum == null || globalPageNum == undefined || globalPageNum == '' || globalPageNum == 'null'){
             globalPageNum = 1;
         }

         // 分页查询
         queryList = function(pageNum){
             // 先读取地址栏
             if(globalPageSize == null || globalPageSize == undefined || globalPageSize == ''){
                 // 再读取输入框
                 globalPageSize = $("#pageSize").val();
                 if(globalPageSize == null || globalPageSize == undefined || globalPageSize == ''){
                     // 都读取不到再赋初始值
                     globalPageSize = 5;
                 }
             }
             // 读取rName
             let rName = $("input[name='rName']").val().trim();
             if(rName === undefined)
                 rName = "";
             layer.load(0)
             $.ajax({
                 type: "GET",
                 url: "/role/list",
                 data: {pageNum:pageNum,pageSize:globalPageSize,jwtToken:jwtToken,rName:rName},
                 success: function (data) {
                     layer.closeAll();
                     if(data.code === 200){
                         // 清除全局pageSize
                         globalPageSize = null;
                         // 填充分页
                         fillPageData(data.obj);
                         // 填充内容
                         fillContent(data.obj);
                     }else{
                         layer.msg(data.msg,function(){})
                     }
                 },
                 complete : function(xhr, status) {
                     myComplete(xhr, status);
                 }
             });
         }
         // 填充内容
         function fillContent(obj){
             let list = obj.list;
             // 清空div
             $("#mycon").empty();
             $.each(list, function(){
                 let rState = this.rState==0 ? "启用" : "禁用";
                 let conbox =
                     " <tr>\n" +
                     "         \t<td style=\"vertical-align:middle;\"><input type=\"checkbox\" name=\"check\" value=\""+ this.rId +"\"></td>\n" +
                     "            <td>"+ this.rName +"</td>\n" +
                     "            <td>"+ rState +"</td>\n" +
                     "            <td><a href=\"editRole.html?pageSize="+obj.pageSize+"&pageNum="+obj.pageNum+"&mId="+this.rId+"\">编辑</a>&nbsp;&nbsp;&nbsp;<a href=\"javascript:alert('删除成功！');\">删除</a> </td>\n" +
                     "        </tr>"
                 $("#mycon").append($(conbox));
             })
         }

         // 删除一个资源信息
         function deleteOne(mId){
             if(confirm("确认删除?")){
                 layer.load(0);
                 $.ajax({
                     type: "POST",
                     url: "/menu/"+ mId,
                     data: {_method:"DELETE",jwtToken:jwtToken},
                     success: function (data) {
                         layer.closeAll();
                         if(data.code === 204){
                             layer.msg("删除成功");
                             queryList($(".current").text())     // 刷新页面
                         }else{
                             layer.msg(data.msg,function(){})
                         }
                     }
                     ,complete : function(xhr, status) {
                         myComplete(xhr, status);
                     }
                 });
             }
         }

        function checkall(){
            var alls=document.getElementsByName("check");
            var ch=document.getElementById("checkall");
            if(ch.checked){
                for(var i=0;i<alls.length;i++){
                    alls[i].checked=true;
                }
            }else{
                for(var i=0;i<alls.length;i++){
                    alls[i].checked=false;
                }
            }
        }
        function delAll(){
            var alls=document.getElementsByName("check");
            var ids=new Array();
            for(var i=0;i<alls.length;i++){
                if(alls[i].checked){
                    ids.push(alls[i].value);
                }
            }
            if(ids.length>0){
                if(confirm("确认删除?")){
                    alert("删除成功!");
                }
            }else{
                alert("请选中要删除的项");
            }
        }
    </script>   
    
</head>
<body>
<form class="form-inline definewidth m20" action="index.html" method="get">  
    角色名称：
    <input type="text" name="rolename" id="rolename"class="abc input-default" placeholder="" value="">&nbsp;&nbsp;  
    <button type="submit" class="btn btn-primary">查询</button>
</form>
<table class="table table-bordered table-hover definewidth m10" >
    <thead>
    <tr>
    	<th width="5%"><input type="checkbox" id="checkall" onChange="checkall();"></th>
        <th>角色名称</th>
        <th>状态</th>
        <th width="10%">操作</th>
    </tr>
    </thead>
    <tbody id="mycon"></tbody>
</table>
        
        
   <table class="table table-bordered table-hover definewidth m10" >
  	<tr><th colspan="5">  <div class="inline pull-right page">
         10122 条记录 1/507 页  <a href='#'>下一页</a>     <span class='current'>1</span><a href='#'>2</a><a href='/chinapost/index.php?m=Label&a=index&p=3'>3</a><a href='#'>4</a><a href='#'>5</a>  <a href='#' >下5页</a> <a href='#' >最后一页</a></div><div><button type="button" class="btn btn-success" id="newNav">添加角色 </button>&nbsp;&nbsp;&nbsp;<button type="button" class="btn btn-success" id="delPro" onClick="delAll();">删除选中</button></div></th></tr>
  </table>     
 </body>
</html>